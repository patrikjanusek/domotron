<!-- Google Analytics -->
<script>

// Asynchronously download the analytics.js JavaScript library
// from https://www.google-analytics.com/analytics.js
// and initialize a global "ga" function
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

// Create a new tracker object for the property UA-XXXXX-Y
// specifiea via the variable "Core - Tracker ID - Google Analytics"
ga('create', '{{Core - Tracker ID - Google Analytics}}', 'auto');

// Load Google Analytics plugins
// ga('require', 'foo');

// Set the user ID using signed-in user_id.
ga('set', 'userId', '{{User Information - Cookie - User ID}}');

// Signal Tag Manager that Google Analytics are ready
// and push clientID to Data Layer

ga(function(tracker) {
  window.dataLayer.push({
    'ClientID' : tracker.get('clientId')
  });
});

// Check if other modules are loaded and signal GTM

window.modules = window.modules || [];
window.modules.push({
  'googleAnalytics' : 'ok'
});

if("{{Debuging - Variable - Debug Mode}}" == "true") {
  console.log("[Domotron] " + "Module Loaded: " + "Google Analytics");
}

if (window.modules.length == {{Modules - Constant - Modules Count}}) {
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    'event' : 'modulesLoaded'
  });
  if("{{Debuging - Variable - Debug Mode}}" == "true") {
    console.log("[Domotron] " + "All Modules Loaded");
  }
};

</script>
<!-- End Google Analytics -->
